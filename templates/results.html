{% extends "base.html" %}
{% block content %}

<h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ” ê²€ìƒ‰ ê²°ê³¼</h2>

<!-- ì¡°ê±´ ìˆ˜ì • í† ê¸€ -->
<div class="flex justify-end mb-4">
  <button onclick="document.getElementById('filterPanel').classList.toggle('hidden')"
          class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-4 py-2 rounded-md shadow hover:shadow-lg transition text-sm">
    ğŸ›ï¸ ì¡°ê±´ ìˆ˜ì •í•˜ê¸°
  </button>
</div>

<!-- ì¡°ê±´ ìˆ˜ì • í¼ -->
<div id="filterPanel" class="hidden mb-10 border border-gray-200 rounded-lg p-6 bg-white shadow-md text-sm">
  <form method="post" action="/search/advanced" class="grid gap-6 grid-cols-1 md:grid-cols-2">

    <!-- ì˜ˆì‚° ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ’° ì˜ˆì‚° (ì›)</label>
      <div id="budget_range" class="mb-2"></div>
      <input type="hidden" name="budget_range_min">
      <input type="hidden" name="budget_range_max">
    </div>

    <!-- CPU ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ§  CPU ì ìˆ˜</label>
      <div id="cpu_range" class="mb-2"></div>
      <input type="hidden" name="cpu_range_min">
      <input type="hidden" name="cpu_range_max">
    </div>

    <!-- GPU ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ® GPU ì ìˆ˜</label>
      <div id="gpu_range" class="mb-2"></div>
      <input type="hidden" name="gpu_range_min">
      <input type="hidden" name="gpu_range_max">
    </div>

    <!-- ë””ìŠ¤í”Œë ˆì´ í¬ê¸° -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ–¥ï¸ ë””ìŠ¤í”Œë ˆì´ í¬ê¸°</label>
      <div class="flex gap-3 flex-wrap">
        {% for size in ['13', '14', '15'] %}
          <label class="flex items-center gap-1 text-gray-600">
            <input type="checkbox" name="display_options" value="{{ size }}" {% if size in selected_display %}checked{% endif %}>
            {{ size }}ì¸ì¹˜ëŒ€
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- RAM -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ’¾ RAM</label>
      <div class="flex gap-3">
        {% for ram in ['8', '16', '32'] %}
          <label class="flex items-center gap-1 text-gray-600">
            <input type="checkbox" name="ram_options" value="{{ ram }}" {% if ram in ram_selected %}checked{% endif %}>
            {{ ram }}GB
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- ì €ì¥ì¥ì¹˜ -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ’½ ì €ì¥ì¥ì¹˜</label>
      <div class="flex gap-3">
        {% for sto in ['256', '512', '1024'] %}
          <label class="flex items-center gap-1 text-gray-600">
            <input type="checkbox" name="storage_options" value="{{ sto }}" {% if sto in storage_selected %}checked{% endif %}>
            {{ sto }}GB
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- í•´ìƒë„ -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ“ í•´ìƒë„ ë“±ê¸‰</label>
      <div class="flex gap-3">
        {% for grade in ['FHDê¸‰', 'QHDê¸‰', 'UHDê¸‰'] %}
          <label class="flex items-center gap-1 text-gray-600">
            <input type="checkbox" name="resolution_options" value="{{ grade }}" {% if grade in res_selected %}checked{% endif %}>
            {{ grade }}
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- í¸ì˜ê¸°ëŠ¥ -->
    <div>
      <label class="block font-semibold text-gray-700 mb-1">ğŸ”Œ í¸ì˜ê¸°ëŠ¥</label>
      <div class="grid grid-cols-2 gap-2">
        {% for key, label in {
          "port_hdmi": "HDMI", "port_sd": "SD ìŠ¬ë¡¯", "port_lan": "LAN í¬íŠ¸",
          "pd_charge": "PD ì¶©ì „", "thunderbolt": "ì¬ë”ë³¼íŠ¸"
        }.items() %}
          <label class="flex items-center gap-1 text-gray-600">
            <input type="checkbox" name="{{ key }}" {% if args.get(key) %}checked{% endif %}> {{ label }}
          </label>
        {% endfor %}
      </div>
    </div>

    <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
    <div class="md:col-span-2">
      <button type="submit" class="mt-4 bg-blue-600 text-white px-5 py-2 rounded-md hover:bg-blue-700 transition">
        ğŸ”„ ë‹¤ì‹œ ê²€ìƒ‰í•˜ê¸°
      </button>
    </div>
  </form>
</div>

<!-- ê²€ìƒ‰ ê²°ê³¼ ì¹´ë“œ -->
<ul class="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
  {% for notebook in notebooks %}
  <li class="border rounded-lg shadow-sm p-5 bg-white hover:shadow-md transition">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">{{ notebook.model_name }}</h3>
    <ul class="text-sm text-gray-600 space-y-1">
      <li>ğŸ§  CPU: {{ notebook.cpu_obj.cpu_model_name }}</li>
      <li>ğŸ® GPU: {{ notebook.gpu_obj.gpu_model_name }}</li>
      <li>ğŸ’¾ RAM: {% for mem in notebook.memories %}{{ mem.capacity }}GB {% endfor %}</li>
      <li>ğŸ’½ ì €ì¥ì†Œ: {% for sto in notebook.storages %}{{ sto.capacity }}GB {{ sto.type }} {% endfor %}</li>
      <li>
        ğŸ’° ê°€ê²©:
        {% if notebook.lowest_price %}
          <span class="font-semibold text-black">{{ "{:,}".format(notebook.lowest_price) }} ì›</span>
        {% else %}
          <span class="text-gray-400">ê°€ê²© ì •ë³´ ì—†ìŒ</span>
        {% endif %}
      </li>
    </ul>
    <a href="/notebook/{{ notebook.notebook_key }}"
       class="inline-block mt-3 text-blue-600 hover:underline text-sm font-medium">ğŸ” ìƒì„¸ ë³´ê¸°</a>
  </li>
  {% endfor %}
</ul>

<!-- noUiSlider -->
<link href="https://cdn.jsdelivr.net/npm/nouislider@15.6.0/dist/nouislider.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.6.0/dist/nouislider.min.js"></script>
<script>
function makeSlider(id, min, max, step, unit) {
  const el = document.getElementById(id);
  const minInput = document.querySelector(`input[name="${id}_min"]`);
  const maxInput = document.querySelector(`input[name="${id}_max"]`);

  const slider = noUiSlider.create(el, {
    start: [min, max],
    connect: true,
    range: { min: min, max: max },
    step: step,
    tooltips: true,
    format: {
      to: v => Math.round(v) + unit,
      from: v => Number(v.replace(unit, ''))
    }
  });

  slider.on('update', (values) => {
    minInput.value = parseInt(values[0].replace(unit, ''));
    maxInput.value = parseInt(values[1].replace(unit, ''));
  });

  return slider;
}

const budgetSlider = makeSlider("budget_range", 300000, 2500000, 50000, "ì›");
const cpuSlider = makeSlider("cpu_range", 3000, 40000, 1000, "");
const gpuSlider = makeSlider("gpu_range", 2000, 50000, 1000, "");

{% if args.get("budget_min") and args.get("budget_max") %}
  budgetSlider.set([{{ args.get("budget_min") | int }}, {{ args.get("budget_max") | int }}]);
{% endif %}
{% if args.get("cpu_min") and args.get("cpu_max") %}
  cpuSlider.set([{{ args.get("cpu_min") | int }}, {{ args.get("cpu_max") | int }}]);
{% endif %}
{% if args.get("gpu_min") and args.get("gpu_max") %}
  gpuSlider.set([{{ args.get("gpu_min") | int }}, {{ args.get("gpu_max") | int }}]);
{% endif %}
</script>

{% endblock %}
