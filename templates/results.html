{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-bold mb-4">ê²€ìƒ‰ ê²°ê³¼</h2>

<!-- ì¡°ê±´ ìˆ˜ì • í† ê¸€ -->
<button onclick="document.getElementById('filterPanel').classList.toggle('hidden')"
        class="mb-4 bg-gray-200 px-4 py-2 rounded hover:bg-gray-300 text-sm">
  ğŸ” ì¡°ê±´ ìˆ˜ì •í•˜ê¸°
</button>

<!-- ì¡°ê±´ ìˆ˜ì • í¼ -->
<div id="filterPanel" class="hidden mb-6 border rounded p-4 bg-gray-50 text-sm">
  <form method="post" action="/search/advanced" class="space-y-4">

    <!-- ì˜ˆì‚° ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-medium">ğŸ’° ì˜ˆì‚° (ì›)</label>
      <div id="budget_range"></div>
      <input type="hidden" name="budget_range_min">
      <input type="hidden" name="budget_range_max">
    </div>

    <!-- CPU ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-medium">ğŸ§  CPU ì ìˆ˜</label>
      <div id="cpu_range"></div>
      <input type="hidden" name="cpu_range_min">
      <input type="hidden" name="cpu_range_max">
    </div>

    <!-- GPU ìŠ¬ë¼ì´ë” -->
    <div>
      <label class="block font-medium">ğŸ® GPU ì ìˆ˜</label>
      <div id="gpu_range"></div>
      <input type="hidden" name="gpu_range_min">
      <input type="hidden" name="gpu_range_max">
    </div>

    <!-- ë””ìŠ¤í”Œë ˆì´ í¬ê¸° (ì„ íƒì§€) -->
    <div>
      <label class="block font-medium">ğŸ–¥ï¸ ë””ìŠ¤í”Œë ˆì´ í¬ê¸°</label>
      {% set selected_display = args.getlist("display_options") %}
      <div class="flex gap-2 flex-wrap">
        {% for size in ['13', '14', '15'] %}
        <label>
          <input type="checkbox" name="display_options" value="{{ size }}"
                 {% if size in selected_display %}checked{% endif %}>
          {{ size }}ì¸ì¹˜ëŒ€
        </label>
        {% endfor %}
      </div>
    </div>

    <!-- RAM -->
    <div>
      <label class="block font-medium">ğŸ’¾ RAM</label>
      {% set ram_selected = args.getlist("ram_options") %}
      <div class="flex gap-2">
        {% for ram in ['8', '16', '32'] %}
        <label>
          <input type="checkbox" name="ram_options" value="{{ ram }}"
                 {% if ram in ram_selected %}checked{% endif %}> {{ ram }}GB
        </label>
        {% endfor %}
      </div>
    </div>

    <!-- ì €ì¥ì¥ì¹˜ -->
    <div>
      <label class="block font-medium">ğŸ’½ ì €ì¥ì¥ì¹˜</label>
      {% set storage_selected = args.getlist("storage_options") %}
      <div class="flex gap-2">
        {% for sto in ['256', '512', '1024'] %}
        <label>
          <input type="checkbox" name="storage_options" value="{{ sto }}"
                 {% if sto in storage_selected %}checked{% endif %}> {{ sto }}GB
        </label>
        {% endfor %}
      </div>
    </div>

    <!-- í•´ìƒë„ í•„í„° -->
    <div>
      <label class="block font-medium">ğŸ“ í•´ìƒë„ ë“±ê¸‰</label>
      {% set res_selected = args.getlist("resolution_options") %}
      <div class="flex gap-2">
        {% for grade in ['FHDê¸‰', 'QHDê¸‰', 'UHDê¸‰'] %}
        <label>
          <input type="checkbox" name="resolution_options" value="{{ grade }}"
                 {% if grade in res_selected %}checked{% endif %}> {{ grade }}
        </label>
        {% endfor %}
      </div>
    </div>

    <!-- í¸ì˜ê¸°ëŠ¥ -->
    <div>
      <label class="block font-medium">ğŸ”Œ í¸ì˜ê¸°ëŠ¥</label>
      <div class="grid grid-cols-2 gap-1">
        {% for key, label in {
          "port_hdmi": "HDMI", "port_sd": "SD ìŠ¬ë¡¯", "port_lan": "LAN í¬íŠ¸",
          "pd_charge": "PD ì¶©ì „", "thunderbolt": "ì¬ë”ë³¼íŠ¸"
        }.items() %}
        <label>
          <input type="checkbox" name="{{ key }}"
                 {% if args.get(key) %}checked{% endif %}> {{ label }}
        </label>
        {% endfor %}
      </div>
    </div>

    <div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm">
        ğŸ”„ ë‹¤ì‹œ ê²€ìƒ‰í•˜ê¸°
      </button>
    </div>
  </form>
</div>

<!-- ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
<ul class="space-y-4 mt-6">
  {% for notebook in notebooks %}
  <li class="border rounded p-4">
    <h3 class="text-lg font-semibold">{{ notebook.model_name }}</h3>
    <p>CPU: {{ notebook.cpu_obj.cpu_model_name }}</p>
    <p>GPU: {{ notebook.gpu_obj.gpu_model_name }}</p>
    <p>RAM: {% for mem in notebook.memories %}{{ mem.capacity }}GB {% endfor %}</p>
    <p>ì €ì¥ì†Œ: {% for sto in notebook.storages %}{{ sto.capacity }}GB {{ sto.type }} {% endfor %}</p>
    <p>
      ê°€ê²©:
      {% if notebook.lowest_price %}
        {{ "{:,}".format(notebook.lowest_price) }} ì›
      {% else %}
        ê°€ê²© ì •ë³´ ì—†ìŒ
      {% endif %}
    </p>
    <a href="/notebook/{{ notebook.notebook_key }}"
   class="text-blue-600 hover:underline text-sm inline-block mt-2">ğŸ” ìƒì„¸ ë³´ê¸°</a>

  </li>
  {% endfor %}
</ul>

<!-- noUiSlider ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<link href="https://cdn.jsdelivr.net/npm/nouislider@15.6.0/dist/nouislider.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.6.0/dist/nouislider.min.js"></script>

<script>
function makeSlider(id, min, max, step, unit) {
  const el = document.getElementById(id);
  const minInput = document.querySelector(`input[name="${id}_min"]`);
  const maxInput = document.querySelector(`input[name="${id}_max"]`);

  const slider = noUiSlider.create(el, {
    start: [min, max],
    connect: true,
    range: { min: min, max: max },
    step: step,
    tooltips: true,
    format: {
      to: v => Math.round(v) + unit,
      from: v => Number(v.replace(unit, ''))
    }
  });

  slider.on('update', (values) => {
    minInput.value = parseInt(values[0].replace(unit, ''));
    maxInput.value = parseInt(values[1].replace(unit, ''));
  });

  return slider;
}

// ìŠ¬ë¼ì´ë” ìƒì„±
const budgetSlider = makeSlider("budget_range", 300000, 2500000, 50000, "ì›");
const cpuSlider = makeSlider("cpu_range", 3000, 40000, 1000, "");
const gpuSlider = makeSlider("gpu_range", 2000, 50000, 1000, "");

// ì¡°ê±´ì´ ìˆì„ ë•Œë§Œ set() í˜¸ì¶œ
{% if args.get("budget_min") and args.get("budget_max") %}
  budgetSlider.set([{{ args.get("budget_min") | int }}, {{ args.get("budget_max") | int }}]);
{% endif %}
{% if args.get("cpu_min") and args.get("cpu_max") %}
  cpuSlider.set([{{ args.get("cpu_min") | int }}, {{ args.get("cpu_max") | int }}]);
{% endif %}
{% if args.get("gpu_min") and args.get("gpu_max") %}
  gpuSlider.set([{{ args.get("gpu_min") | int }}, {{ args.get("gpu_max") | int }}]);
{% endif %}
</script>




{% endblock %}
